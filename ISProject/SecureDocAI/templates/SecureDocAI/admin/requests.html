{% extends "SecureDocAI/admin/layout.html" %}
{% load static %}  <!-- Make sure this is at the top -->

{% block title %}DocumentRequest - SecureDocAI{% endblock %}

{% block content %}
<style>
    
a {
    text-decoration: none;
}
p.no-documents {
    padding: 1rem;
    margin-top: 2rem;
    background-color: #fef3c7; /* light yellow */
    color: #92400e;             /* dark amber text */
    border: 1px solid #fde68a;
    border-radius: 0.5rem;
    font-weight: 500;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);

}

</style>


<div class="sidebar">
    <div class="sidebar-header">
        <h1>SecureDocAI</h1>
        <p>Admin Dashboard</p>
    </div>
    <nav class="sidebar-nav">
        <a href="{% url 'admin_dashboard' %}" class="nav-item " data-tab="dashboard">
            <i data-lucide="bar-chart-3"></i>
            Dashboard
        </a>
        <a href="{% url 'admin_Requests' %}" class="nav-item active"  data-tab="requests">
            <i data-lucide="clock"></i>
            Document Requests
        </a>
        <a href="{% url 'admin_Doc' %}" class="nav-item" data-tab="documents">
            <i data-lucide="file-text"></i>
            All Documents
        </a>
        <a href="{%  url 'admin_users' %}" class="nav-item" data-tab="users">
            <i data-lucide="users"></i>
            User Management
        </a>
        <a href="{% url 'admin_accesslog' %}" class="nav-item" data-tab="settings">
            <i data-lucide="history"></i>
            Access log
        </a>
        <a href="{% url 'admin_risk' %}" class="nav-item " data-tab="settings">
            <i data-lucide="alert-triangle	"></i>
            Risk Check
        </a>
    </nav>
    <a href="{% url 'logout' %}" class="logout-btn">
        <i data-lucide="log-out"></i>
        Logout
    </a>
</div>


<main class="main-content">
    <section>
        <h2>Document Access Requests</h2>
        <div class="card">
            <div class="table-header">
                <div class="search-box">
                    <i data-lucide="search"></i>
                    <input type="text" id="searchInput" placeholder="Search requests..." />
                </div>
                <button class="filter-btn">
                    <i data-lucide="filter"></i> Filter
                </button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Reviewer</th>
                        <th>Document</th>
                        <th>Classification</th> <!-- New Column -->
                        <th>Uploaded by</th> 
                        <th>Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="riskLogTable">
                    {% for request in review_requests %}
                    <tr>
                        <td>{{ request.reviewer.username }}</td>
                        <td>{{ request.document.title }}</td>
                        <td>{{ request.document.classification }}</td> 
                        <td>{{ request.document.uploader.username }}</td>
                        <td>{{ request.requested_at|date:"Y-m-d" }}</td>
                        <td>
                            {% if request.status == 'pending' %}
                                <span class="status pending">Pending</span>
                            {% elif request.status == 'accepted' %}
                                <span class="status accepted">Accepted</span>
                            {% elif request.status == 'denied' %}
                                <span class="status denied">Denied</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if request.status == 'pending' %}
                                <a href="{% url 'update_review_status' %}?request_id={{ request.id }}&action=accept" class="action-btn accept" title="Accept">
                                    <i data-lucide="check-circle-2"></i>
                                </a>
                                <a href="{% url 'update_review_status' %}?request_id={{ request.id }}&action=deny" class="action-btn deny" title="Deny">
                                    <i data-lucide="x-circle"></i>
                                </a>
                            {% else %}
                                <em>No actions</em>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7">No review requests found.</td> <!-- updated colspan to match new columns -->
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            
        </div>
    </section>
</main>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("searchInput");
        const tableRows = document.querySelectorAll("#riskLogTable tr");

        searchInput.addEventListener("keyup", function () {
            const filter = searchInput.value.toLowerCase();

            tableRows.forEach(function (row) {
                const rowText = row.textContent.toLowerCase();
                if (rowText.includes(filter)) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            });

            // Optionally show "no results" message
            const anyVisible = Array.from(tableRows).some(row => row.style.display !== "none");
            const noLogsRow = document.querySelector(".table-no-logs");
            if (noLogsRow) {
                noLogsRow.style.display = anyVisible ? "none" : "";
            }
        });
    });
</script>



<script>lucide.createIcons();</script>
{% endblock %}
